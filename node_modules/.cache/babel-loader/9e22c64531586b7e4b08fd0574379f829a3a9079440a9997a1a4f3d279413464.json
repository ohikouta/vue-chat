{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport { collection, addDoc, onSnapshot } from 'firebase/firestore';\nimport { auth } from '../firebaseConfig'; // ここで firebaseConfig.js から auth をインポート\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { db } from '../firebaseConfig';\nimport MessageList from '../components/MessageList.vue';\nimport MessageInput from '../components/MessageInput.vue';\nexport default {\n  components: {\n    MessageList,\n    MessageInput\n  },\n  setup() {\n    const messages = ref([]);\n    const currentUser = ref(null);\n    const fetchMessages = () => {\n      const q = collection(db, \"messages\");\n      onSnapshot(q, querySnapshot => {\n        messages.value = querySnapshot.docs.map(doc => doc.data());\n        console.log(\"Loaded messages:\", messages.value);\n      });\n    };\n    onAuthStateChanged(auth, user => {\n      if (user) {\n        currentUser.value = user;\n        console.log('User is logged in:', user.uid);\n      } else {\n        console.error('No user is signed in');\n      }\n    });\n    const sendMessage = async message => {\n      try {\n        if (currentUser.value) {\n          await addDoc(collection(db, \"messages\"), {\n            text: message,\n            timestamp: new Date(),\n            userId: currentUser.value.uid,\n            userName: currentUser.value.displayName\n          });\n        } else {\n          console.error(\"User is not logged in or currentUser is null\");\n        }\n      } catch (e) {\n        console.error(\"Error adding document: \", e);\n      }\n    };\n    onMounted(fetchMessages);\n    return {\n      messages,\n      currentUser,\n      sendMessage\n    };\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}