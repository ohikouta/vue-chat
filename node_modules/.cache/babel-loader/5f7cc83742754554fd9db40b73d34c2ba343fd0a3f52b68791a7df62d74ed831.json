{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport { collection, addDoc, onSnapshot } from 'firebase/firestore';\nimport { db } from '../firebaseConfig';\nimport { auth } from '../firebaseConfig';\nimport MessageList from '../components/MessageList.vue';\nimport MessageInput from '../components/MessageInput.vue';\nimport 'firebase/auth';\nimport 'firebase/firestore';\nexport default {\n  components: {\n    MessageList,\n    MessageInput\n  },\n  setup() {\n    const messages = ref([]);\n    const fetchMessages = () => {\n      const q = collection(db, \"messages\");\n      onSnapshot(q, querySnapshot => {\n        messages.value = querySnapshot.docs.map(doc => doc.data());\n      });\n    };\n    onAuthStateChanged(auth, user => {\n      if (user) {\n        // ユーザーがログインしている場合\n        console.log('User is logged in:', user.uid);\n        // ここで user.uid を使った操作を行う\n      } else {\n        console.error('No user is signed in');\n        // ユーザーがログインしていない場合の処理\n      }\n    });\n    const sendMessage = async message => {\n      try {\n        const user = auth.currentUser;\n        if (user) {\n          console.log('ああ');\n          // const userId = user.uid;\n          // メッセージ送信やその他の操作をここで実行\n        } else {\n          console.error(\"User is not logged in or currentUser is null\");\n          // 必要に応じて、ログインページにリダイレクトするなどの対応を行う\n        }\n        await addDoc(collection(db, \"messages\"), {\n          text: message,\n          timestamp: new Date(),\n          userId: user.uid,\n          userName: user.displayName\n        });\n      } catch (e) {\n        console.error(\"Error adding document: \", e);\n      }\n    };\n    onMounted(fetchMessages);\n    return {\n      messages,\n      sendMessage\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","collection","addDoc","onSnapshot","db","auth","MessageList","MessageInput","components","setup","messages","fetchMessages","q","querySnapshot","value","docs","map","doc","data","onAuthStateChanged","user","console","log","uid","error","sendMessage","message","currentUser","text","timestamp","Date","userId","userName","displayName","e"],"sources":["/Users/koutaohi/docker/vue-chat/vueApp/vue-sample/src/views/ChatView.vue"],"sourcesContent":["<template>\n  <div class=\"chat-view\">\n    <MessageList :messages=\"messages\" />\n    <MessageInput @sendMessage=\"sendMessage\" />\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted } from 'vue';\nimport { collection, addDoc, onSnapshot } from 'firebase/firestore';\nimport { db } from '../firebaseConfig';\nimport { auth } from '../firebaseConfig';\nimport MessageList from '../components/MessageList.vue';\nimport MessageInput from '../components/MessageInput.vue';\nimport 'firebase/auth';\nimport 'firebase/firestore';\n\nexport default {\n  components: {\n    MessageList,\n    MessageInput\n  },\n  setup() {\n    const messages = ref([]);\n\n    const fetchMessages = () => {\n      const q = collection(db, \"messages\");\n      onSnapshot(q, (querySnapshot) => {\n        messages.value = querySnapshot.docs.map(doc => doc.data());\n      });\n    };\n\n    onAuthStateChanged(auth, (user) => {\n      if (user) {\n        // ユーザーがログインしている場合\n        console.log('User is logged in:', user.uid);\n        // ここで user.uid を使った操作を行う\n      } else {\n        console.error('No user is signed in');\n        // ユーザーがログインしていない場合の処理\n      }\n    });\n\n    const sendMessage = async (message) => {\n      try {\n        const user = auth.currentUser;\n        if (user) {\n          console.log('ああ')\n          // const userId = user.uid;\n          // メッセージ送信やその他の操作をここで実行\n        } else {\n          console.error(\"User is not logged in or currentUser is null\")\n          // 必要に応じて、ログインページにリダイレクトするなどの対応を行う\n        }\n        await addDoc(collection(db, \"messages\"), {\n          text: message,\n          timestamp: new Date(),\n          userId: user.uid,\n          userName: user.displayName,\n        });\n      } catch (e) {\n        console.error(\"Error adding document: \", e);\n      }\n    };\n\n    onMounted(fetchMessages);\n\n    return {\n      messages,\n      sendMessage\n    };\n  }\n};\n</script>\n\n<style scoped>\n.chat-view {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  justify-content: space-between;\n}\n</style>\n"],"mappings":"AAQA,SAASA,GAAG,EAAEC,SAAQ,QAAS,KAAK;AACpC,SAASC,UAAU,EAAEC,MAAM,EAAEC,UAAS,QAAS,oBAAoB;AACnE,SAASC,EAAC,QAAS,mBAAmB;AACtC,SAASC,IAAG,QAAS,mBAAmB;AACxC,OAAOC,WAAU,MAAO,+BAA+B;AACvD,OAAOC,YAAW,MAAO,gCAAgC;AACzD,OAAO,eAAe;AACtB,OAAO,oBAAoB;AAE3B,eAAe;EACbC,UAAU,EAAE;IACVF,WAAW;IACXC;EACF,CAAC;EACDE,KAAKA,CAAA,EAAG;IACN,MAAMC,QAAO,GAAIX,GAAG,CAAC,EAAE,CAAC;IAExB,MAAMY,aAAY,GAAIA,CAAA,KAAM;MAC1B,MAAMC,CAAA,GAAIX,UAAU,CAACG,EAAE,EAAE,UAAU,CAAC;MACpCD,UAAU,CAACS,CAAC,EAAGC,aAAa,IAAK;QAC/BH,QAAQ,CAACI,KAAI,GAAID,aAAa,CAACE,IAAI,CAACC,GAAG,CAACC,GAAE,IAAKA,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC;MAC5D,CAAC,CAAC;IACJ,CAAC;IAEDC,kBAAkB,CAACd,IAAI,EAAGe,IAAI,IAAK;MACjC,IAAIA,IAAI,EAAE;QACR;QACAC,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEF,IAAI,CAACG,GAAG,CAAC;QAC3C;MACF,OAAO;QACLF,OAAO,CAACG,KAAK,CAAC,sBAAsB,CAAC;QACrC;MACF;IACF,CAAC,CAAC;IAEF,MAAMC,WAAU,GAAI,MAAOC,OAAO,IAAK;MACrC,IAAI;QACF,MAAMN,IAAG,GAAIf,IAAI,CAACsB,WAAW;QAC7B,IAAIP,IAAI,EAAE;UACRC,OAAO,CAACC,GAAG,CAAC,IAAI;UAChB;UACA;QACF,OAAO;UACLD,OAAO,CAACG,KAAK,CAAC,8CAA8C;UAC5D;QACF;QACA,MAAMtB,MAAM,CAACD,UAAU,CAACG,EAAE,EAAE,UAAU,CAAC,EAAE;UACvCwB,IAAI,EAAEF,OAAO;UACbG,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC;UACrBC,MAAM,EAAEX,IAAI,CAACG,GAAG;UAChBS,QAAQ,EAAEZ,IAAI,CAACa;QACjB,CAAC,CAAC;MACJ,EAAE,OAAOC,CAAC,EAAE;QACVb,OAAO,CAACG,KAAK,CAAC,yBAAyB,EAAEU,CAAC,CAAC;MAC7C;IACF,CAAC;IAEDlC,SAAS,CAACW,aAAa,CAAC;IAExB,OAAO;MACLD,QAAQ;MACRe;IACF,CAAC;EACH;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}